<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‚Äì Lor-Panich</title>

<style>
  body {
    margin: 0;
    background: #e5e5e5;
    font-family: "Sarabun", sans-serif;
  }

  /* A4 PAGE */
  .a4-page {
    width: 210mm;
    min-height: 297mm;
    margin: 24px auto;
    background: #fff;
    color: #000;
    padding: 20mm 18mm;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    page-break-after: always;
  }

  .header {
    text-align: center;
    margin-bottom: 16px;
  }

  .shop-name {
    font-size: 20px;
    font-weight: 700;
  }

  .doc-title {
    font-size: 16px;
    margin-top: 4px;
  }

  .meta {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    margin-bottom: 14px;
  }

  .table {
    border-top: 1px solid #000;
  }

  .row {
    display: grid;
    grid-template-columns: 50px 1fr 60px 70px 80px;
    gap: 8px;
    padding: 8px 0;
    border-bottom: 1px solid #ccc;
    font-size: 13px;
  }

  .row.header {
    font-weight: 600;
    border-bottom: 2px solid #000;
  }

  .product img {
    width: 48px;
    height: 48px;
    object-fit: cover;
  }

  .center { text-align: center; }
  .right  { text-align: right; }

  .footer {
    margin-top: 24px;
    display: flex;
    justify-content: space-between;
    font-size: 14px;
  }

  .total {
    font-weight: 700;
  }

  @media print {
    body {
      background: none;
    }
    .a4-page {
      margin: 0;
      box-shadow: none;
    }
  }
</style>
</head>

<body>
<div id="pages-root"></div>
  
<script>
  const raw = sessionStorage.getItem('order_summary');
  if (!raw) {
    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
  } else {
    const data = JSON.parse(raw);
    const items = data.items || [];

    const pagesRoot = document.getElementById('pages-root');

    function createPage() {
      const page = document.createElement('div');
      page.className = 'a4-page';
      page.innerHTML = `
        <div class="header">
          <div class="shop-name">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ Lor-Panich</div>
          <div class="doc-title">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
        </div>

        <div class="meta">
          <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: __________</div>
          <div>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: __________</div>
        </div>

        <div class="table">
          <div class="row header">
            <div>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            <div>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
            <div class="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div>
            <div class="right">‡∏£‡∏≤‡∏Ñ‡∏≤</div>
            <div class="right">‡∏£‡∏ß‡∏°</div>
          </div>
          <div class="order-items"></div>
        </div>
   <div class="footer">
     <div class="total">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: 0 ‡∏ö‡∏≤‡∏ó</div>
     <div>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥ ____________________</div>
   </div>
      `;
      pagesRoot.appendChild(page);
      return page;
    }

    let currentPage = createPage();
    let itemsContainer = currentPage.querySelector('.order-items');
    let totalEl = currentPage.querySelector('.total');
    let total = 0;

    items.forEach(item => {
      const subtotal = item.‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô * item.‡∏à‡∏≥‡∏ô‡∏ß‡∏ô;
      total += subtotal;

      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div class="product">
          ${item.‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ? `<img src="${item.‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤}" />` : ''}
        </div>
        <div>
          <div><strong>${item.‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤}</strong></div>
          <div style="font-size:11px;color:#555;">SKU: ${item['‡∏£‡∏´‡∏±‡∏™ SKU']}</div>
        </div>
        <div class="center">${item.‡∏à‡∏≥‡∏ô‡∏ß‡∏ô}</div>
        <div class="right">${item.‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô}</div>
        <div class="right">${subtotal}</div>
      `;

      itemsContainer.appendChild(row);

      // üî¥ ‡∏ï‡∏£‡∏ß‡∏à overflow
      if (itemsContainer.scrollHeight > itemsContainer.clientHeight) {
        itemsContainer.removeChild(row);
        currentPage = createPage();
        itemsContainer = currentPage.querySelector('.order-items');
        totalEl = currentPage.querySelector('.total');
        itemsContainer.appendChild(row);
     }
    });

    totalEl.innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: ${total} ‡∏ö‡∏≤‡∏ó`;
   }
  
</script>
  
</body>
</html>

